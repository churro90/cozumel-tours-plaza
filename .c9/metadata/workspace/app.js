{"changed":true,"filter":false,"title":"app.js","tooltip":"/app.js","value":"var express       = require(\"express\"),\n    app           = express(),\n    bodyParser    = require(\"body-parser\"),\n    Country       = require(\"./models/countries\"),\n    nodemailer    = require(\"nodemailer\"),\n    flash         = require(\"connect-flash\"),\n    passport      = require(\"passport\"),\n    User          = require(\"./models/user\"),\n    mongoose      = require(\"mongoose\"),\n    LocalStrategy = require(\"passport-local\");\n    \n    \napp.use(bodyParser.urlencoded({extended: true}));\napp.set(\"view engine\", \"ejs\");\napp.use(express.static(__dirname + \"/public\"));\nmongoose.connect(process.env.MONGODB); //definir como variable de ambiente!!!!!\napp.use(require(\"express-session\")({\n    secret: \"Yo soy bien picota pa las bromas\",\n    resave: false,\n    saveUninitialized: false\n}));\napp.use(flash());\napp.use(passport.initialize());\napp.use(passport.session());\npassport.use(new LocalStrategy(User.authenticate()));\npassport.serializeUser(User.serializeUser());\npassport.deserializeUser(User.deserializeUser());\n\n\n\napp.use(function(req, res, next){\n   res.locals.currentUser = req.user;\n   res.locals.error = req.flash(\"error\");\n   res.locals.success = req.flash(\"success\");\n   next();\n});    \n    \napp.get(\"/\", function(req, res){\n   res.render(\"landing\"); \n});\n\napp.get(\"/hiring-a-driver\", function(req, res){\n    res.render(\"landing\");\n});\n\napp.get(\"/about-us\", function(req, res){\n    res.render(\"about-us\");\n});\n\napp.get(\"/prices\", function(req, res) {\n    res.render(\"prices\");\n});\n\n//==================BOOKING ROUTES================\n\napp.get(\"/booking\", function(req, res) {\n    Country.find({}, function(err, Countries){\n        if(err){\n            console.log(err);\n        } \n        else {\n            res.render(\"booking\", {countries: Countries});\n        }\n    })\n    \n});\n\napp.get(\"/payment\", function(req, res) {\n   res.render(\"payment\"); \n});\n\napp.post(\"/booking\", function(req, res) {\n    var subject = req.body.firstName + \" \" + req.body.lastName + \" \" + req.body.date + \" NR\";\n    var output = `\n     <h1> Tienes una nueva solicitud de reserva:</h1>\n     <br>\n     <h3>Detalles</h3>\n     <ul>\n        <li>Nombre: ${req.body.firstName} ${req.body.lastName} </li>\n        <li>Email:  ${req.body.email} </li>\n        <li>Fecha:  ${req.body.date} </li>\n        <li>Hora:   ${req.body.startTime} </li>\n        <li>Hotel or ship:  ${req.body.arrival} </li>\n        <li>Crucero/Hotel:  ${req.body.hotelOrCruise} </li>\n        <li>Tipo de servicio:  ${req.body.vehicle} </li>\n        <li>Numero de personas:  ${req.body.people} </li>\n        <li>Pais:  ${req.body.country} </li>\n        <li>Celular:  ${req.body.areaCode}${req.body.cellphone}  </li>\n        <li>Comentarios:  ${req.body.info} </li>\n        <li>Requerimientos:  ${req.body.requirements} </li>\n        <li>Item adicionales:  ${req.body.babySeat} </li>\n    </ul>\n    `;\n    \n nodemailer.createTestAccount((err, account) => {\n\n    // create reusable transporter object using the default SMTP transport\n    let transporter = nodemailer.createTransport({\n        host: 'smtp.gmail.com',\n        port: 465,\n        secure: true, // true for 465, false for other ports\n        auth: {\n            user: process.env.GMAIL_ACCOUNT, // generated ethereal user\n            pass: process.env.GMAIL_PASSWORD // generated ethereal password\n        },\n        tls:{\n            rejectUnauthorized: false\n        }\n    });\n\n    // setup email data with unicode symbols\n    let mailOptions = {\n        from: process.env.GMAIL_ACCOUNT, // sender address\n        to:   process.env.RECEIVER, // list of receivers\n        subject: subject, // Subject line\n        html: output // html body\n    };\n\n    // send mail with defined transport object\n    transporter.sendMail(mailOptions, (error, info) => {\n        if (error) {\n            req.flash(\"error\", \"There was an error submiting your reservation, please contact us directly at eduardoczm@gmail.com or try again\");\n            return res.redirect(\"booking\");\n        }\n            else {\n        \n        return res.render(\"payment\", {\"success\":\"Your reservation was succesfully submited\",\n           info: req.body }\n        );\n            }\n    });\n});  \n});\n\n\n\n\n// =============CONTACT ROUTES==========\napp.get(\"/contact\", function(req, res){\n   res.render(\"contact\"); \n});\n\napp.post(\"/contact\", function(req, res){\n    var subject= req.body.subject;\n    var email = req.body.email;\n    var output = `\n     <h1> Tienes una nueva consulta:</h1>\n     <br>\n     <h3>Detalles del contacto</h3>\n     <ul>\n        <li>Nombre: ${req.body.name} </li>\n        <li>Email:  ${req.body.email} </li>\n    </ul>\n    <h3>Mensaje</h3>\n    <p> ${req.body.message}</p>\n     </ul>\n    `;\n    \n   \n\n// Generate test SMTP service account from ethereal.email\n// Only needed if you don't have a real mail account for testing\nnodemailer.createTestAccount((err, account) => {\n\n    // create reusable transporter object using the default SMTP transport\n    let transporter = nodemailer.createTransport({\n        host: 'smtp.gmail.com',\n        port: 465,\n        secure: true, // true for 465, false for other ports\n        auth: {\n            user: process.env.GMAIL_ACCOUNT, // generated ethereal user\n            pass: process.env.GMAIL_PASSWORD // generated ethereal password\n        },\n        tls:{\n            rejectUnauthorized: false\n        }\n    });\n\n    // setup email data with unicode symbols\n    let mailOptions = {\n        from: process.env.GMAIL_ACCOUNT, // sender address\n        to:   process.env.RECEIVER, // list of receivers\n        subject: subject, // Subject line\n        html: output // html body\n    };\n\n    // send mail with defined transport object\n    transporter.sendMail(mailOptions, (error, info) => {\n        if (error) {\n            req.flash(\"error\", \"There was an error submiting your form, please contact us directly at eduardoczm@gmail.com or try again\");\n            return res.redirect(\"contact\");\n        } else {\n       \n       req.flash(\"success\", \"Message sent successfully, we will get back to you as soon as possible\");\n       return res.redirect(\"contact\");\n        \n        }\n    });\n});\n});\n    \napp.get(\"/faq\", function(req, res) {\n    res.render(\"faq\");\n});\n \n    \napp.listen(process.env.PORT, process.env.IP, function(){\n   console.log(\"Servidor iniciado\");\n});","undoManager":{"mark":68,"position":100,"stack":[[{"start":{"row":127,"column":14},"end":{"row":127,"column":15},"action":"remove","lines":["r"],"id":4992}],[{"start":{"row":127,"column":13},"end":{"row":127,"column":14},"action":"remove","lines":["i"],"id":4993}],[{"start":{"row":127,"column":12},"end":{"row":127,"column":13},"action":"remove","lines":["f"],"id":4994}],[{"start":{"row":127,"column":12},"end":{"row":127,"column":13},"action":"insert","lines":["i"],"id":4995}],[{"start":{"row":127,"column":13},"end":{"row":127,"column":14},"action":"insert","lines":["n"],"id":4996}],[{"start":{"row":127,"column":14},"end":{"row":127,"column":15},"action":"insert","lines":["f"],"id":4997}],[{"start":{"row":127,"column":15},"end":{"row":127,"column":16},"action":"insert","lines":["o"],"id":4998}],[{"start":{"row":127,"column":26},"end":{"row":127,"column":27},"action":"remove","lines":["."],"id":4999}],[{"start":{"row":127,"column":26},"end":{"row":127,"column":27},"action":"remove","lines":["f"],"id":5000}],[{"start":{"row":127,"column":26},"end":{"row":127,"column":27},"action":"remove","lines":["i"],"id":5001}],[{"start":{"row":127,"column":26},"end":{"row":127,"column":27},"action":"remove","lines":["r"],"id":5002}],[{"start":{"row":127,"column":26},"end":{"row":127,"column":27},"action":"remove","lines":["s"],"id":5003}],[{"start":{"row":127,"column":26},"end":{"row":127,"column":27},"action":"remove","lines":["t"],"id":5004}],[{"start":{"row":127,"column":26},"end":{"row":127,"column":27},"action":"remove","lines":["N"],"id":5005}],[{"start":{"row":127,"column":26},"end":{"row":127,"column":27},"action":"remove","lines":["a"],"id":5006}],[{"start":{"row":127,"column":26},"end":{"row":127,"column":27},"action":"remove","lines":["m"],"id":5007}],[{"start":{"row":127,"column":26},"end":{"row":127,"column":27},"action":"remove","lines":["e"],"id":5008}],[{"start":{"row":128,"column":8},"end":{"row":128,"column":12},"action":"insert","lines":["    "],"id":5009}],[{"start":{"row":128,"column":12},"end":{"row":128,"column":13},"action":"insert","lines":["c"],"id":5010}],[{"start":{"row":128,"column":13},"end":{"row":128,"column":14},"action":"insert","lines":["o"],"id":5011}],[{"start":{"row":128,"column":14},"end":{"row":128,"column":15},"action":"insert","lines":["n"],"id":5012}],[{"start":{"row":128,"column":15},"end":{"row":128,"column":16},"action":"insert","lines":["s"],"id":5013}],[{"start":{"row":128,"column":16},"end":{"row":128,"column":17},"action":"insert","lines":["o"],"id":5014}],[{"start":{"row":128,"column":17},"end":{"row":128,"column":18},"action":"insert","lines":["l"],"id":5015}],[{"start":{"row":128,"column":17},"end":{"row":128,"column":18},"action":"remove","lines":["l"],"id":5016}],[{"start":{"row":128,"column":16},"end":{"row":128,"column":17},"action":"remove","lines":["o"],"id":5017}],[{"start":{"row":128,"column":15},"end":{"row":128,"column":16},"action":"remove","lines":["s"],"id":5018}],[{"start":{"row":128,"column":14},"end":{"row":128,"column":15},"action":"remove","lines":["n"],"id":5019}],[{"start":{"row":128,"column":13},"end":{"row":128,"column":14},"action":"remove","lines":["o"],"id":5020}],[{"start":{"row":128,"column":12},"end":{"row":128,"column":13},"action":"remove","lines":["c"],"id":5021}],[{"start":{"row":128,"column":8},"end":{"row":128,"column":12},"action":"remove","lines":["    "],"id":5022}],[{"start":{"row":127,"column":28},"end":{"row":128,"column":8},"action":"remove","lines":["","        "],"id":5023}],[{"start":{"row":125,"column":7},"end":{"row":125,"column":8},"action":"insert","lines":[" "],"id":5024}],[{"start":{"row":125,"column":8},"end":{"row":125,"column":9},"action":"insert","lines":["c"],"id":5025}],[{"start":{"row":125,"column":9},"end":{"row":125,"column":10},"action":"insert","lines":["o"],"id":5026}],[{"start":{"row":125,"column":10},"end":{"row":125,"column":11},"action":"insert","lines":["n"],"id":5027}],[{"start":{"row":125,"column":11},"end":{"row":125,"column":12},"action":"insert","lines":["s"],"id":5028}],[{"start":{"row":125,"column":12},"end":{"row":125,"column":13},"action":"insert","lines":["o"],"id":5029}],[{"start":{"row":125,"column":13},"end":{"row":125,"column":14},"action":"insert","lines":["l"],"id":5030}],[{"start":{"row":125,"column":14},"end":{"row":125,"column":15},"action":"insert","lines":["e"],"id":5031}],[{"start":{"row":125,"column":15},"end":{"row":125,"column":16},"action":"insert","lines":["."],"id":5032}],[{"start":{"row":125,"column":16},"end":{"row":125,"column":17},"action":"insert","lines":["l"],"id":5033}],[{"start":{"row":125,"column":17},"end":{"row":125,"column":18},"action":"insert","lines":["o"],"id":5034}],[{"start":{"row":125,"column":18},"end":{"row":125,"column":19},"action":"insert","lines":["g"],"id":5035}],[{"start":{"row":125,"column":19},"end":{"row":125,"column":21},"action":"insert","lines":["()"],"id":5036}],[{"start":{"row":125,"column":20},"end":{"row":125,"column":21},"action":"insert","lines":["r"],"id":5037}],[{"start":{"row":125,"column":21},"end":{"row":125,"column":22},"action":"insert","lines":["e"],"id":5038}],[{"start":{"row":125,"column":22},"end":{"row":125,"column":23},"action":"insert","lines":["q"],"id":5039}],[{"start":{"row":125,"column":22},"end":{"row":125,"column":23},"action":"remove","lines":["q"],"id":5040}],[{"start":{"row":125,"column":21},"end":{"row":125,"column":22},"action":"remove","lines":["e"],"id":5041}],[{"start":{"row":125,"column":20},"end":{"row":125,"column":21},"action":"remove","lines":["r"],"id":5042}],[{"start":{"row":125,"column":19},"end":{"row":125,"column":21},"action":"remove","lines":["()"],"id":5043}],[{"start":{"row":125,"column":18},"end":{"row":125,"column":19},"action":"remove","lines":["g"],"id":5044}],[{"start":{"row":125,"column":17},"end":{"row":125,"column":18},"action":"remove","lines":["o"],"id":5045}],[{"start":{"row":125,"column":16},"end":{"row":125,"column":17},"action":"remove","lines":["l"],"id":5046}],[{"start":{"row":125,"column":15},"end":{"row":125,"column":16},"action":"remove","lines":["."],"id":5047}],[{"start":{"row":125,"column":14},"end":{"row":125,"column":15},"action":"remove","lines":["e"],"id":5048}],[{"start":{"row":125,"column":13},"end":{"row":125,"column":14},"action":"remove","lines":["l"],"id":5049}],[{"start":{"row":125,"column":12},"end":{"row":125,"column":13},"action":"remove","lines":["o"],"id":5050}],[{"start":{"row":125,"column":11},"end":{"row":125,"column":12},"action":"remove","lines":["s"],"id":5051}],[{"start":{"row":125,"column":10},"end":{"row":125,"column":11},"action":"remove","lines":["n"],"id":5052}],[{"start":{"row":125,"column":9},"end":{"row":125,"column":10},"action":"remove","lines":["o"],"id":5053}],[{"start":{"row":125,"column":8},"end":{"row":125,"column":9},"action":"remove","lines":["c"],"id":5054}],[{"start":{"row":126,"column":92},"end":{"row":126,"column":93},"action":"remove","lines":[","],"id":5055}],[{"start":{"row":127,"column":27},"end":{"row":127,"column":28},"action":"remove","lines":["}"],"id":5057}],[{"start":{"row":127,"column":10},"end":{"row":127,"column":11},"action":"remove","lines":["{"],"id":5058}],[{"start":{"row":126,"column":91},"end":{"row":126,"column":92},"action":"remove","lines":["}"],"id":5059}],[{"start":{"row":126,"column":91},"end":{"row":126,"column":92},"action":"insert","lines":[","],"id":5060}],[{"start":{"row":127,"column":26},"end":{"row":127,"column":27},"action":"insert","lines":["}"],"id":5061}],[{"start":{"row":113,"column":42},"end":{"row":113,"column":43},"action":"remove","lines":[","],"id":5157}],[{"start":{"row":113,"column":41},"end":{"row":113,"column":42},"action":"remove","lines":["\""],"id":5158}],[{"start":{"row":113,"column":40},"end":{"row":113,"column":41},"action":"remove","lines":["m"],"id":5159}],[{"start":{"row":113,"column":39},"end":{"row":113,"column":40},"action":"remove","lines":["o"],"id":5160}],[{"start":{"row":113,"column":38},"end":{"row":113,"column":39},"action":"remove","lines":["c"],"id":5161}],[{"start":{"row":113,"column":37},"end":{"row":113,"column":38},"action":"remove","lines":["."],"id":5162}],[{"start":{"row":113,"column":36},"end":{"row":113,"column":37},"action":"remove","lines":["l"],"id":5163}],[{"start":{"row":113,"column":35},"end":{"row":113,"column":36},"action":"remove","lines":["i"],"id":5164}],[{"start":{"row":113,"column":34},"end":{"row":113,"column":35},"action":"remove","lines":["a"],"id":5165}],[{"start":{"row":113,"column":33},"end":{"row":113,"column":34},"action":"remove","lines":["m"],"id":5166}],[{"start":{"row":113,"column":32},"end":{"row":113,"column":33},"action":"remove","lines":["g"],"id":5167}],[{"start":{"row":113,"column":31},"end":{"row":113,"column":32},"action":"remove","lines":["@"],"id":5168}],[{"start":{"row":113,"column":30},"end":{"row":113,"column":31},"action":"remove","lines":["f"],"id":5169}],[{"start":{"row":113,"column":29},"end":{"row":113,"column":30},"action":"remove","lines":["o"],"id":5170}],[{"start":{"row":113,"column":28},"end":{"row":113,"column":29},"action":"remove","lines":["c"],"id":5171}],[{"start":{"row":113,"column":27},"end":{"row":113,"column":28},"action":"remove","lines":["s"],"id":5172}],[{"start":{"row":113,"column":26},"end":{"row":113,"column":27},"action":"remove","lines":["a"],"id":5173}],[{"start":{"row":113,"column":25},"end":{"row":113,"column":26},"action":"remove","lines":["r"],"id":5174}],[{"start":{"row":113,"column":24},"end":{"row":113,"column":25},"action":"remove","lines":["r"],"id":5175}],[{"start":{"row":113,"column":23},"end":{"row":113,"column":24},"action":"remove","lines":["a"],"id":5176}],[{"start":{"row":113,"column":22},"end":{"row":113,"column":23},"action":"remove","lines":["c"],"id":5177}],[{"start":{"row":113,"column":21},"end":{"row":113,"column":22},"action":"remove","lines":["."],"id":5178}],[{"start":{"row":113,"column":20},"end":{"row":113,"column":21},"action":"remove","lines":["n"],"id":5179}],[{"start":{"row":113,"column":19},"end":{"row":113,"column":20},"action":"remove","lines":["i"],"id":5180}],[{"start":{"row":113,"column":18},"end":{"row":113,"column":19},"action":"remove","lines":["t"],"id":5181}],[{"start":{"row":113,"column":17},"end":{"row":113,"column":18},"action":"remove","lines":["r"],"id":5182}],[{"start":{"row":113,"column":16},"end":{"row":113,"column":17},"action":"remove","lines":["a"],"id":5183}],[{"start":{"row":113,"column":15},"end":{"row":113,"column":16},"action":"remove","lines":["m"],"id":5184}],[{"start":{"row":113,"column":14},"end":{"row":113,"column":15},"action":"remove","lines":["\""],"id":5185}],[{"start":{"row":113,"column":14},"end":{"row":113,"column":15},"action":"remove","lines":[" "],"id":5186}],[{"start":{"row":113,"column":14},"end":{"row":113,"column":15},"action":"remove","lines":["/"],"id":5187}],[{"start":{"row":113,"column":14},"end":{"row":113,"column":15},"action":"remove","lines":["/"],"id":5188}]]},"ace":{"folds":[],"scrolltop":2518,"scrollleft":0,"selection":{"start":{"row":113,"column":14},"end":{"row":113,"column":14},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":166,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1514496599100}